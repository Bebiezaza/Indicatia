plugins {
    id "fabric-loom" version "0.2.4-SNAPSHOT"
    id "maven-publish"
    id "com.matthewprenger.cursegradle" version "1.3.0"
}

def api = new groovy.json.JsonSlurper().parseText(file("${api_token_path}").text)
def mcVersion = project.mc_version
def version = project.version
def hasInternal = project.hasProperty("internal")

apply plugin: net.fabricmc.loom.LoomGradlePlugin
archivesBaseName = "Indicatia"
sourceCompatibility = targetCompatibility = 1.8

sourceSets.main {
    java {
        srcDirs = ["src/main/java", "dependencies/main/java"]
    }
    resources {
        srcDirs = ["src/main/resources", "dependencies/main/resources"]
    }
}

minecraft {
    refmapName = "indicatia-refmap.json"
}

repositories {
    // Curse Gradle
    maven {
        url "https://plugins.gradle.org/m2/"
    }
    // Cloth
    maven {
        url "https://minecraft.curseforge.com/api/maven"
    }
    // CottonMC
    maven {
        url "http://server.bbkr.space:8081/artifactory/libs-snapshot"
    }
}

jar {
    include "micdoodle8/**"
    include "stevekung/mods/indicatia/**"
    include "assets/indicatia/**"
    include "fabric.mod.json"
    include "indicatia.client.json"
    include "indicatia-refmap.json"
    include "pack.mcmeta"
    baseName = "Indicatia-" + mcVersion
}

dependencies {
	minecraft "com.mojang:minecraft:1.14.4"
    mappings "net.fabricmc:yarn:1.14.4+build.+"
    modCompile "net.fabricmc:fabric-loader:0.4.8+build.+"
    modCompile "net.fabricmc.fabric-api:fabric-api:0.3.0+build.+"

    //modCompile "me.shedaniel.cloth:config-2:0.4.1" TODO
    modCompile "io.github.prospector.modmenu:ModMenu:1.6.3-95"
    modCompile "io.github.cottonmc:cotton-client-commands:0.4.2+1.14.3-SNAPSHOT"
}

curseforge {
    apiKey = api.indicatia
    project {
        id = "272146"
        changelog = ""
        changelogType = "markdown"
        releaseType = "beta"
        addGameVersion mcVersion

        mainArtifact(file("build/libs/Indicatia-" + mcVersion + "-" + version + ".jar")) {
            displayName = "Indicatia-" + mcVersion + "-" + version
            relations {
                requiredLibrary "stevekungs-lib"
            }
        }
    }
}