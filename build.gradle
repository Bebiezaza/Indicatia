plugins {
    id "fabric-loom" version "0.2.7-SNAPSHOT"
    id "maven-publish"
    id "signing"
    id "com.matthewprenger.cursegradle" version "1.4.0"
}

def mcVersion = project.mc_version
def version = project.version

apply plugin: net.fabricmc.loom.LoomGradlePlugin
archivesBaseName = "Indicatia-" + mcVersion
sourceCompatibility = targetCompatibility = compileJava.sourceCompatibility = compileJava.targetCompatibility = 1.8

dependencies {
    minecraft "com.mojang:minecraft:${mc_version}"
    mappings "net.fabricmc:yarn:${mc_version}+build.+:v2"
    modApi "net.fabricmc:fabric-loader:${fabric_loader_version}"
    modApi "net.fabricmc.fabric-api:fabric-api:${fabric_api_version}"
    modImplementation "io.github.prospector:modmenu:${mod_menu_version}"
    modImplementation("me.shedaniel.cloth:config-2:${cloth_config_version}") { transitive = false }
    modImplementation "io.github.cottonmc:cotton-client-commands:1.0.0+1.15.2"
    modImplementation "com.stevekung.stevekungslib:SteveKunG's-Lib:${mc_version}-1.0.0-dev"

    include "me.shedaniel.cloth:config-2:${cloth_config_version}"

    compile "com.google.code.findbugs:jsr305:3.0.2"
}

minecraft {
    refmapName = "indicatia-refmap.json"
}

repositories {
    maven {
        url "https://plugins.gradle.org/m2/"
    }
    maven {
        url "https://minecraft.curseforge.com/api/maven"
    }
    maven {
        url "https://server.bbkr.space/artifactory/libs-release"
    }
    maven {
        url "https://jitpack.io"
    }
    flatDir { dir "libs" }
}

curseforge {
    apiKey = project.indicatia_api
    project {
        id = "272146"
        changelog = file("CHANGE_LOG.md")
        changelogType = "markdown"
        releaseType = "release"
        addGameVersion mcVersion
        addGameVersion "Fabric"
        addGameVersion "Java 8"

        mainArtifact(jar) {
            displayName = "Indicatia-" + mcVersion + "-" + version
        }
        relations {
            requiredDependency "stevekungs-lib"
            requiredDependency "fabric-api"
        }
        afterEvaluate {
            uploadTask.dependsOn("remapJar")
            uploadTask.dependsOn("remapSourcesJar")
        }
    }
    options {
        forgeGradleIntegration = false
        javaVersionAutoDetect = false
    }
}